<?xml version="1.0" encoding="UTF-8"?>
<bpmn2:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xmlns="http://www.omg.org/bpmn20"
                   xmlns:bpmn2="http://www.omg.org/spec/BPMN/20100524/MODEL"
                   xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
                   xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
                   xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
                   xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd"
                   targetNamespace="http://www.omg.org/bpmn20">
    <bpmn2:process id="test" name="my test" isExecutable="true">
        <bpmn2:property id="transition"/>

        <bpmn2:startEvent id="start" name="start">
            <bpmn2:outgoing>saved</bpmn2:outgoing>
        </bpmn2:startEvent>

        <bpmn2:sequenceFlow id="born" sourceRef="start" targetRef="savedIncoming"/>

        <bpmn2:exclusiveGateway id="savedIncoming" name="savedIncoming" gatewayDirection="Converging">
            <bpmn2:outgoing>saved</bpmn2:outgoing>
        </bpmn2:exclusiveGateway>

        <bpmn2:sequenceFlow id="save" sourceRef="savedIncoming" targetRef="saved"/>

        <bpmn2:manualTask id="saved" name="saved">
            <bpmn2:outgoing>savedGatewayFlow</bpmn2:outgoing>
            <bpmn2:ioSpecification>
                <bpmn2:dataOutput id="result" name="transition"/>
                <bpmn2:inputSet></bpmn2:inputSet>
                <bpmn2:outputSet><bpmn2:dataOutputRefs>result</bpmn2:dataOutputRefs></bpmn2:outputSet>
            </bpmn2:ioSpecification>
            <bpmn2:dataOutputAssociation>
                <bpmn2:sourceRef>result</bpmn2:sourceRef>
                <bpmn2:targetRef>transition</bpmn2:targetRef>
            </bpmn2:dataOutputAssociation>
        </bpmn2:manualTask>

        <bpmn2:sequenceFlow id="savedGatewayFlow" sourceRef="saved" targetRef="savedTransitions"/>

        <bpmn2:exclusiveGateway id="savedTransitions" name="savedTransitions" gatewayDirection="Diverging">
            <bpmn2:outgoing>approve</bpmn2:outgoing>
            <bpmn2:outgoing>reject</bpmn2:outgoing>
        </bpmn2:exclusiveGateway>

        <bpmn2:sequenceFlow id="approve" name="approve" sourceRef="savedTransitions" targetRef="published">
            <bpmn2:conditionExpression>
                return "approve".equals(transition)
            </bpmn2:conditionExpression>
        </bpmn2:sequenceFlow>

        <bpmn2:sequenceFlow id="reject" name="reject" sourceRef="savedTransitions" targetRef="review">
            <bpmn2:conditionExpression>
                return "reject".equals(transition)
            </bpmn2:conditionExpression>
        </bpmn2:sequenceFlow>

        <bpmn2:manualTask id="review" name="review">
            <bpmn2:incoming>reject</bpmn2:incoming>
            <bpmn2:outgoing>resubmit</bpmn2:outgoing>
        </bpmn2:manualTask>

        <bpmn2:sequenceFlow sourceRef="review" targetRef="savedIncoming"/>

        <bpmn2:manualTask id="published" name="published">
            <bpmn2:incoming>approve</bpmn2:incoming>
        </bpmn2:manualTask>

        <bpmn2:sequenceFlow id="killed" sourceRef="published" targetRef="end"/>

        <bpmn2:endEvent id="end" name="end">
            <bpmn2:incoming>killed</bpmn2:incoming>
        </bpmn2:endEvent>

    </bpmn2:process>
</bpmn2:definitions>
